<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nocturna Wheel Simple Integration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #333;
        }
        
        #chart-container {
            width: 500px;
            height: 500px;
            border: 1px solid #ddd;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .console {
            width: 100%;
            max-width: 700px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        button {
            margin: 5px;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>Nocturna Wheel Simple Integration</h1>
    
    <div id="chart-container"></div>
    
    <div>
        <button id="create-svg">Step 1: Create SVG</button>
        <button id="create-circle">Step 2: Draw Circle</button>
        <button id="add-planets">Step 3: Add Planets</button>
        <button id="use-bundle">Try Using Bundle</button>
    </div>
    
    <div class="console" id="console-output"></div>
    
    <!-- Global stubs for direct DOM manipulation -->
    <script>
        // Console output helper
        function log(message) {
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.innerHTML += message + '\n';
            console.log(message);
        }
        
        // Create the SVG element directly
        document.getElementById('create-svg').addEventListener('click', function() {
            try {
                const container = document.getElementById('chart-container');
                
                // Create SVG element
                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute("width", "100%");
                svg.setAttribute("height", "100%");
                svg.setAttribute("viewBox", "0 0 500 500");
                
                // Add it to the container
                container.innerHTML = '';
                container.appendChild(svg);
                
                // Store reference
                window.chartSvg = svg;
                
                log("SVG element created successfully");
            } catch (error) {
                log("Error creating SVG: " + error.message);
            }
        });
        
        // Draw a basic circle
        document.getElementById('create-circle').addEventListener('click', function() {
            try {
                if (!window.chartSvg) {
                    throw new Error("SVG not created yet. Click 'Create SVG' first");
                }
                
                const svgNS = "http://www.w3.org/2000/svg";
                
                // Create a group for zodiac
                const zodiacGroup = document.createElementNS(svgNS, "g");
                zodiacGroup.setAttribute("class", "zodiac-group");
                window.chartSvg.appendChild(zodiacGroup);
                
                // Create outer circle
                const circle = document.createElementNS(svgNS, "circle");
                circle.setAttribute("cx", "250");
                circle.setAttribute("cy", "250");
                circle.setAttribute("r", "200");
                circle.setAttribute("fill", "none");
                circle.setAttribute("stroke", "#333");
                circle.setAttribute("stroke-width", "2");
                
                zodiacGroup.appendChild(circle);
                
                log("Circle drawn successfully");
            } catch (error) {
                log("Error drawing circle: " + error.message);
            }
        });
        
        // Add some planet dots
        document.getElementById('add-planets').addEventListener('click', function() {
            try {
                if (!window.chartSvg) {
                    throw new Error("SVG not created yet. Click 'Create SVG' first");
                }
                
                const svgNS = "http://www.w3.org/2000/svg";
                
                // Create a group for planets
                const planetsGroup = document.createElementNS(svgNS, "g");
                planetsGroup.setAttribute("class", "planets-group");
                window.chartSvg.appendChild(planetsGroup);
                
                // Add some planets at different angles
                const planets = [
                    { name: "Sun", angle: 45, color: "#ff6600" },
                    { name: "Moon", angle: 120, color: "#3399cc" },
                    { name: "Mercury", angle: 200, color: "#cc66cc" },
                    { name: "Venus", angle: 270, color: "#cc3333" }
                ];
                
                planets.forEach(planet => {
                    // Calculate position on circle
                    const angleRad = (planet.angle - 90) * Math.PI / 180;
                    const radius = 150; // Slightly inside the main circle
                    const x = 250 + radius * Math.cos(angleRad);
                    const y = 250 + radius * Math.sin(angleRad);
                    
                    // Create planet dot
                    const dot = document.createElementNS(svgNS, "circle");
                    dot.setAttribute("cx", x);
                    dot.setAttribute("cy", y);
                    dot.setAttribute("r", "8");
                    dot.setAttribute("fill", planet.color);
                    dot.setAttribute("stroke", "#fff");
                    dot.setAttribute("stroke-width", "1");
                    dot.setAttribute("title", planet.name);
                    
                    planetsGroup.appendChild(dot);
                    
                    // Add text label
                    const text = document.createElementNS(svgNS, "text");
                    text.setAttribute("x", x);
                    text.setAttribute("y", y - 15);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("fill", "#333");
                    text.setAttribute("font-size", "12px");
                    text.textContent = planet.name;
                    
                    planetsGroup.appendChild(text);
                });
                
                log("Planets added successfully");
            } catch (error) {
                log("Error adding planets: " + error.message);
            }
        });
    </script>
    
    <!-- Load globals.js first to ensure all classes are defined -->
    <script src="dist/globals.js"></script>

    <!-- Then load the Nocturna Wheel UMD bundle -->
    <script src="dist/nocturna-wheel.umd.js"></script>

    <!-- Try using the bundle -->
    <script>
        document.getElementById('use-bundle').addEventListener('click', function() {
            try {
                log("Trying to use Nocturna Wheel bundle...");
                
                const container = document.getElementById('chart-container');
                container.innerHTML = ''; // Clear previous content
                
                // Access through window object
                if (!window.NocturnaWheel) {
                    throw new Error("NocturnaWheel not found on window object");
                }
                
                log("NocturnaWheel found in global scope");
                
                // Get the constructor
                const { WheelChart } = window.NocturnaWheel;
                
                // Create minimal chart instance
                const chart = new WheelChart({
                    container: '#chart-container',
                    planets: {
                        sun: { lon: 45, color: '#ff6600' },
                        moon: { lon: 120, color: '#3399cc' },
                        mercury: { lon: 200, color: '#cc66cc' },
                        venus: { lon: 270, color: '#cc3333' }
                    },
                    config: {
                        assets: { basePath: './assets/' },
                        zodiacSettings: { enabled: true },
                        planetSettings: { enabled: true },
                        houseSettings: { enabled: false }, // Disable houses for simplicity
                        aspectSettings: { enabled: false } // Disable aspects for simplicity
                    }
                });
                
                log("Chart instance created");
                
                // Try to render with special error handling
                try {
                    chart.render();
                    log("Chart rendered successfully");
                } catch (renderError) {
                    log("Error during render: " + renderError.message);
                    
                    // Try to identify what went wrong
                    if (renderError.message.includes("appendChild") && renderError.message.includes("Node")) {
                        log("DOM node issue detected. This might be due to the SVG element creation in the stubs.");
                        
                        // Let's try to create a basic chart manually to at least show something
                        log("Creating basic chart manually instead...");
                        document.getElementById('create-svg').click();
                        document.getElementById('create-circle').click();
                        document.getElementById('add-planets').click();
                    }
                }
                
            } catch (error) {
                log("Error using bundle: " + error.message);
            }
        });
    </script>
</body>
</html> 